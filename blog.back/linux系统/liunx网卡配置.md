## 路由实例
假设我们现在有一台交换机，其中他的网卡设定如下
```bash
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp4s0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc mq state DOWN group default qlen 1000
    link/ether 00:8c:fa:f3:ad:a0 brd ff:ff:ff:ff:ff:ff
3: enp5s0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:8c:fa:f3:ad:a1 brd ff:ff:ff:ff:ff:ff
    inet 10.0.5.157/20 brd 10.0.15.255 scope global noprefixroute enp5s0
       valid_lft forever preferred_lft forever
    inet6 fd24:bd8e:902c::8ab/128 scope global noprefixroute 
       valid_lft forever preferred_lft forever
    inet6 fd24:bd8e:902c:0:1837:5a07:3e7d:b0a6/64 scope global noprefixroute 
       valid_lft forever preferred_lft forever
    inet6 fe80::d20b:2d21:94d9:d45a/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
4: enp10s0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc mq state DOWN group default qlen 1000
    link/ether 00:8c:fa:f3:ad:a2 brd ff:ff:ff:ff:ff:ff
5: enp11s0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc mq state DOWN group default qlen 1000
    link/ether 00:8c:fa:f3:ad:a3 brd ff:ff:ff:ff:ff:ff
6: enp1s0f0: <NO-CARRIER,BROADCAST,MULTICAST,UP> mtu 1500 qdisc mq state DOWN group default qlen 1000
    link/ether 00:1b:21:85:6f:e0 brd ff:ff:ff:ff:ff:ff
7: enp1s0f1: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:1b:21:85:6f:e1 brd ff:ff:ff:ff:ff:ff
    inet 10.255.0.3/24 brd 10.255.0.255 scope global noprefixroute enp1s0f1
       valid_lft forever preferred_lft forever
    inet6 fe80::6bc2:c0cf:31e3:af4f/64 scope link noprefixroute 
       valid_lft forever preferred_lft forever
```
我们可以看出其中我们有一个网卡enp5s0和光卡enp1s0f1，其中光卡连着交换机，不同办公网，无法ping通外网,enp5s0可以通外网，现在我们升级该服务器的内核，发现rpm包无法下载
```bash
[root@localhost ~]# rpm --import https://www.elrepo.org/RPM-GPG-KEY-elrepo.org
curl: (6) Could not resolve host: www.elrepo.org; 未知的错误
错误：https://www.elrepo.org/RPM-GPG-KEY-elrepo.org: import read failed(2).
[root@localhost ~]# rpm -Uvh http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm
获取http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm
curl: (6) Could not resolve host: www.elrepo.org; 未知的错误
错误：跳过 http://www.elrepo.org/elrepo-release-7.0-2.el7.elrepo.noarch.rpm - 传输失败
```
首先我们查看DNS解析,发现DNS解析是错误的
```bash
[root@localhost ~]# vi /etc/resolv.conf

# Generated by NetworkManager
nameserver fd24:bd8e:902c::1
```
**解决过程**
1.关闭NetworkManager
```bash
systemctl stop NetworkManager
systemctl disable NetworkMnager
```
2.设置DNS内容

修改DNS内容有两种方法，直接修改/etc/resolv.conf 或者再/etc/sysconfig/network-scripts/ifcfg-eth0中添加
如果我们采用了第一种方法，那么服务器重启后会丢失，需要设置/etc/syscofnig/network-scripts/ifcfg-eth0下面添加PEERDNS=no，配置如下
```bash
# /etc/sysconfig/network-scripts/ifcfg-eth0下
PEERDNS=no

# /etc/resolv.conf下
nameserver=114.114.114.114
nameserver=8.8.8.8
```
如果我们采用第二种方法，配置如下
```bash
# /etc/sysconfig/network-scripts/ifcfg-eth0下
PEERDNS=yes
DNS1=114.114.114.114
DNS2=8.8.8.8
```
3.重启网卡
service network restart



## 设置默认路由
如上，设置完DNS之后，我们发现还是ping不同办公网
**解决过程**
1.查看路由 
```bash
[root@localhost ~]# ip ro
default via 10.255.0.254 dev enp1s0f1 proto static metric 100 
default via 10.0.0.130 dev enp5s0 proto static metric 101 
10.0.0.0/20 dev enp5s0 proto kernel scope link src 10.0.5.156 metric 101 
10.255.0.0/24 dev enp1s0f1 proto kernel scope link src 10.255.0.2 metric 100
```
因为当前默认路由为10.255.0.254,无法通办公网，所以要重新设置默认路由
2.设置默认路由
```bash
ip ro re default via 10.0.0.130
# 再次查看当前路由
ip ro
default via 10.0.0.130 dev enp5s0 
default via 10.255.0.254 dev enp1s0f1 proto static metric 100 
default via 10.0.0.130 dev enp5s0 proto static metric 101 
10.0.0.0/20 dev enp5s0 proto kernel scope link src 10.0.5.156 metric 101 
10.255.0.0/24 dev enp1s0f1 proto kernel scope link src 10.255.0.2 metric 100 
```
顺利ping通办公网，另外重启服务器会重置路由
















