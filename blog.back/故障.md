---
title: linux故障问题及解决方案
categories:
  - linux
tags:
  - linux
abbrlink: bc3af3e9
date: 2020-01-09 12:23:01
---

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [linux故障问题及解决方案](#linux故障问题及解决方案)
  - [忘记root密码，无法登陆服务器](#忘记root密码无法登陆服务器)
  - [解决内网ssh连接速度很慢的解决方案](#解决内网ssh连接速度很慢的解决方案)

<!-- /code_chunk_output -->
# linux故障问题及解决方案

linux系统使用过程中 会遇到很多的故障和报错，与之对应的是一些快速的解决方案
这里记录一下

<!-- more -->

## 忘记root密码，无法登陆服务器

-----

<font color='blue'>centos7 解决方案</font>
- 重启服务器
- 进入启动界面后选择e进入编辑引导
- 修改内容,在尾部添加rd.break
```bash
linux16 /vmlinuz-3.10.0-123.el7.x86_64 root=UUID=449d53d1-84c2-40c0-b05e-d1900591d71b ro rd.lvm.lv=vg_kvm7usb/swap crashkernel=auto 
vconsole.keymap=us crashkernel=auto vconsole.font=latarcyrheb-sun16 rd.lvm.lv=vg_kvm7usb/root rhgb quiet LANG=en_US.UTF-8  rd.break 
```
- ctrl+x 以当前设定开机
开机后的互动式命令环境，並不是正常开机的系統，正常开机系統挂载在 /sysboo 且挂载成只读，必須重新挂载成可写入，才能修改密碼
- 重新挂在 /sysroot 并改成可读可写
```bash
mount –o remount,rw /sysroot
```
- chroot 工作目录到/sysroot
```bash
chroot /sysroot 
```
- 设定新的root 密码
```bash
passwd root
upyun1
upyun1
```
在此情況下，SELinux 並沒有启动，对所有文件的更改，可能会造成文档的context 不正确，为确保开机时重新设定SELinux context，必須在根目录下添加隐藏文件.autorelabel。
- 避开selinux
```bash
touch /.autorelabel 
```
- 重启
```bash
reboot 
```

<font color='blue'>centos7 解决方案二</font>
- 重启服务器
- 按e编辑引导
- 修改re 为 rw 添加 init=/bin/bash 
```bash
linux16 /vmlinuz-3.10.0-123.el7.x86_64 root=UUID=449d53d1-84c2-40c0-b05e-d1900591d71b rw rd.lvm.lv=vg_kvm7usb/swap crashkernel=auto 
vconsole.keymap=us crashkernel=auto vconsole.font=latarcyrheb-sun16 rd.lvm.lv=vg_kvm7usb/root rhgb quiet LANG=en_US.UTF-8  init=/bin/bash
```
- ctrl+x 以当前设定开机
- 重置密码
```bash
passwd root
upyun1
upyun1 
```
- 避开selinux
```bash
touch /.autorelabel 
```
- 重启
```bash
exec /sbin/init 
```

-----


## 解决内网ssh连接速度很慢的解决方案
```bash
服务器相互ping是延时小，但ssh -p 端口号 内网IP 时发现很慢，好长时间才返回。把服务器改按以下方法修改相应配置，再ssh相互连接发现很快：
# vi /etc/ssh/sshd_conf
UseDNS no
GSSAPIAuthentication no
```