---
title: django实际项目中的模块设计
categories:
  - 编程
tags:
  - django
abbrlink: c83ed08b
date: 2020-02-14 01:53:20
---

learn django 🐢
<!-- more -->


# django实际模块设计



## 多级联动菜单设计

数据库设计
```bash
class MenusModel(models.Model):
    "菜单类别"
    MENU_TYPE=(
        (1, "一级类目"),
        (2, "二级类目"),
    )
    name = models.CharField(max_length=10,verbose_name="菜单栏名字")
    icon = models.CharField(max_length=20,verbose_name="菜单栏图标")
    path = models.CharField(max_length=20,verbose_name="菜单栏指向路径")
    menu_type = models.CharField(choices=MENU_TYPE,verbose_name="菜单类别",max_length=1)
    parent = models.ForeignKey('self', default=0, null=True, blank=True, related_name='children', \
                               verbose_name='父分类',on_delete=models.CASCADE)
    class Meta:
        verbose_name = "菜单栏名字"
        verbose_name_plural = verbose_name 
```
![2020-02-14-01-55-00](http://img.noback.top/2020-02-14-01-55-00.png)

序列化设计
```bash
# 二级菜单筛选
class MenusSerializer2(serializers.ModelSerializer):
    class Meta:
        model = MenusModel
        fields = "__all__"

# 一级菜单筛选
class MenusSerializer(serializers.ModelSerializer):
    children = MenusSerializer2(many=True)
    class Meta:
        model = MenusModel
        fields = "__all__" 
```

view视图设计
```bash
class MenuVeiw(viewsets.GenericViewSet,
               mixins.ListModelMixin):
    queryset = MenusModel.objects.filter(menu_type=1)
    serializer_class = MenusSerializer
```

效果
![2020-02-14-01-57-08](http://img.noback.top/2020-02-14-01-57-08.png)


## 多级联动菜单设计2

数据库设计
```bash
class GoodsCategory(BaseModel):
 # """
 # 商品类别
 # """

 class MenusModel(models.Model):
    "菜单类别"
    MENU_TYPE=(
        (1, "一级类目"),
        (2, "二级类目"),
    )
    name = models.CharField(max_length=10,verbose_name="菜单栏名字")
    icon = models.CharField(max_length=20,verbose_name="菜单栏图标")
    path = models.CharField(max_length=20,verbose_name="菜单栏指向路径")
    menu_type = models.CharField(choices=MENU_TYPE,verbose_name="菜单类别",max_length=1)
    parent = models.ForeignKey('self', default=0, null=True, blank=True, related_name='children', \
                               verbose_name='父分类',on_delete=models.CASCADE)
    class Meta:
        db_name = menu_db
        verbose_name = "菜单栏名字"
        verbose_name_plural = verbose_name 
```

序列化设计，利用数据库的反向查询
```bash
from rest_framework import serializers
from .models import GoodsCategory

class CategorySerializer3(serializers.ModelSerializer):
    class Meta:
        model = GoodsCategory
        fields = "__all__"


class CategorySerializer2(serializers.ModelSerializer):
    sub_cat = CategorySerializer3(many=True)
    class Meta:
        model = GoodsCategory
        fields = "__all__"


class CategorySerializer(serializers.ModelSerializer):
    sub_cat = CategorySerializer2(many=True)
    class Meta:
        model = GoodsCategory
        fields = "__all__" 
```

view设计
```bash
class CategoryInfoView(mixins.ListModelMixin,GenericAPIView):
    queryset = GoodsCategory.objects.filter(parent=None)
    serializer_class = CategorySerializer
    def get(self,request):
        return self.list(request) 
```

效果
![2020-02-14-01-57-08](http://img.noback.top/2020-02-14-01-57-08.png)



## 报错
```bash
$ python3 manage.py runserver 0.0.0.0:8888
Watching for file changes with StatReloader 

```
端口被占用 kill或者重启其他端口