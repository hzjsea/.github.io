## 背景
搭建一个100G网络测试环境用于数据测试

## 准备内容
10台20G服务器(充当流量模拟器),2台6800交换机


## 搭建过程
如果服务器只是用电口的网线的话，不能达到每台20G的流量，因此要换用光口用AOC跳线连接，每一个口达到10G的流量标准，再用bond0做绑定达到20G的流量要求

1.更换服务器的光卡设备
![](http://img.noback.top/IMG_20190829_111740.jpg)
![](http://img.noback.top/IMG_20190829_111837.jpg)
![](http://img.noback.top/IMG_20190829_112432.jpg)
![](http://img.noback.top/IMG_20190829_114951.jpg)

2.安装Centos7系统
3.配置系统内容
4.建立网络
5.安装软件  iperf mtr

## 配置系统内容
#### 单网卡配置
```bash
TYPE=Ethernet
PROXY_METHOD=none
BROWSER_ONLY=no
BOOTPROTO=static
DEFROUTE=yes
NAME=enp11s0
UUID=d9432f58-45b6-437b-8f33-812137711abb
DEVICE=enp11s0
ONBOOT=yes
IPADDR=10.0.5.98   # IP地址
NETMASK=255.255.240.0 # 子网掩码
GATEWAY=10.0.0.130 # 办公网网关
```

#### 双网卡捆绑配置
**Centos7捆绑**
```bash
[root@DT-LNA-12 network-scripts]# cat ifcfg-bond0
DEVICE=bond0
ONBOOT=yes
IPADDR=111.111.111.111
PREFIX＝24
GATEWAY=111.111.111.1
BONDING_MASTER=yes
BONDING_OPTS="miimon=100 mode=2 xmit_hash_policy=1" 
[root@DT-LNA-12 network-scripts]# cat ifcfg-eno1
DEVICE=eno1
ONBOOT=yes
MASTER=bond0
SLAVE=yes
[root@DT-LNA-12 network-scripts]# cat ifcfg-eno2
DEVICE=eno2
ONBOOT=yes
MASTER=bond0
SLAVE=yes
```
**配置完成，重启网络配置,systemctl restart network**
**Centos6捆绑**
https://docs.google.com/document/d/1u52iQVIAJHaVitig7cKTU0PBm3epo0Nz-33tEqTp8R0/edit#heading=h.bw1jpfj576zk


## 网络建立
![](http://img.noback.top/100G%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83.png)
如图所示所有服务器通过办公网交换机连接办公网，即访问公网。另外连接管理交换机进行被管理。
在路由中我们需要建立两条路由
1.服务器内部IP互相间访问
```bash
ip ro add 10.2.0.0/24 via 10.1.0.254 dev bond0 
```
2.服务器指向办公网交换机
```bash
ip ro re default via 10.0.0.130 dev enp11s0 
```

## 安装软件
1.关闭NetworkManager
```bash
systemctl stop NetworkManager
systemctl disable NetworkManager
```
2.添加DNS
```bash
vi /etc/resolv.conf
nameserver 114.114.114.114
```
3.下载软件
```bash
yum install iperf3 mtr -y
```

