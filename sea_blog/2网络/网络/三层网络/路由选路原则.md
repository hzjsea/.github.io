# 路由选路原则

<font color='red'>为何要会出现路由选路?</font>
当一个目标地址被多个目标网络覆盖，一个目标网络的多种路由协议的多条路径共存时，或当一个目标网络同一种路由协议的多条路径共存时，路由器的转发规则。

## 管理距离
管理距离是用来提供路由可信度的一个参考值，管理距离越小，路由条目越可靠。这意味着，有较小管理距离的路由条目将优先于较大的条目，管理距离的取值范围从0-255，0是最可信，255是最不可信，如果一台路由收到同一个网络的两条路由更新，路由器将选择管理距离较小的那条，放入路由表。
同时，不同的路由协议具有不同的默认管理距离
```txt
路由源                  默认管理距离
直接接口                    0
静态路由(使用外出接口)        0
静态路由(使用下一跳IP)        1
EIGPR 汇总路由              5
外部BGP                    20
内部EIGRP                  90
IGRP                      100
OSPF                      110
IS-IS                     115
RIP                       120
EGP                       140                      
外部EIGRP                  170
内部BGP                    200
```
## 路由选路原则
### 子网掩码最长匹配
如果一个目标地址被多个网络目标覆盖，它将优先选择最长的子网掩码的路由。比如到达10.0.0.1网络有两条路由条目:10.0.0.0/24下一跳是12.1.1.2,10.0.0.0/16的下一跳是13.1.1.3，因为第一条的子网掩码/24大于第二条的/16，所以路由将到达10.0.0.1网络的数据发往12.1.1.2；而如果路由上有发往10.0.1.1的数据，则选择10.0.0.0/16，因为10.0.1.1不包含在10.0.0.0/24网络中。
### 管理距离最小优先
在子网掩码长度相同的情况下，路由器优先选择管理距离最小的路由条目。比如到达10.1.1.0/24路由有两条，一条是通过RIP学习来的，管理距离是120，一条是通过OSPF学习到的，管理距离是110，那么路由器优先选择OSPF学习到的路由条目放进自己的路由表中。

RIP和OSPF学习到的10.1.1.0/24的条目不会同时出现在路由表中，路由器只会保存最优路径，如果OSPF学习到的那个条目消失，RIP学习到的路由条目才会出现在路由表中。请注意，这里必须强调的是，相同的路由条目（RIP和OSPF同时报告了一个相同的子网，路由优先选择OSPF，因为在子网掩码长度相同的前提下，OSPF有更小的管理距离）。

### 度量值最小优先
如果路由的子网掩码长度相等，管理距离也相等，接下来比较度量值，度量值最小的将进入路由表。比如路由器通过RIP学习到了10.0.0.0/24的两个条目，一个条目的跳数(hop)是2，另一个的跳数是3，那么，路由器选择跳数是2的那个条目放入路由表。

### 静态路由排错
静态路由需要对指，有去有回才能达到互通