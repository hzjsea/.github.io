---
title: 业务迁移解决方案
categories:
  - fastapi
tags:
  - fastapi
abbrlink: 9f242e9a
date: 2020-06-03 17:23:32
---

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [业务迁移解决方案](#业务迁移解决方案)
  - [操作步骤](#操作步骤)
    - [CDN加速](#cdn加速)
    - [云存储](#云存储)
    - [厚德云创建项目](#厚德云创建项目)
    - [厚德云开启数据库](#厚德云开启数据库)
    - [https开通](#https开通)

<!-- /code_chunk_output -->
<!-- more -->

# 业务迁移解决方案
![2020-06-04-11-09-19](http://noback.upyun.com/2020-06-04-11-09-19.png)

上图是一开始的项目结构，开发在自己的机器或者公有云上做部署项目，分别对源站和云存储做了CDN 用户访问对应内容通过CDN访问源站或者节点上的缓存，达到加速的目的，本地公有云本地mysql映射给自己的项目

![2020-06-04-11-15-11](http://noback.upyun.com/2020-06-04-11-15-11.png)

首次迁移,程序可以先进行迁移，现将程序部署到容器中，数据库依旧还是使用公有云源站的数据库

![2020-06-04-11-15-29](http://noback.upyun.com/2020-06-04-11-15-29.png)

第二次迁移，数据库也使用容器


## 操作步骤

### CDN加速

登录又拍云，注册账号，创建云存储服务和CDN加速服务
![2020-06-04-15-48-31](http://noback.upyun.com/2020-06-04-15-48-31.png)
进入控制台 创建云存储服务和CDN加速服务
![2020-06-04-15-49-25](http://noback.upyun.com/2020-06-04-15-49-25.png)
创建CDN服务
![2020-06-04-15-55-20](http://noback.upyun.com/2020-06-04-15-55-20.png)
![2020-06-04-15-56-31](http://noback.upyun.com/2020-06-04-15-56-31.png)

<font color='red'>记得设置参数跟随，不然无法访问api 缓存控制-->参数跟随---> 全程跟随</font>

进入阿里云或者其他的共有云做cname
![2020-06-04-11-38-16](http://noback.upyun.com/2020-06-04-11-38-16.png)



### 云存储
登录又拍云，点击云存储，创建云存储
![2020-06-04-16-00-51](http://noback.upyun.com/2020-06-04-16-00-51.png)
![2020-06-04-16-02-05](http://noback.upyun.com/2020-06-04-16-02-05.png)




### 厚德云创建项目
![2020-06-04-11-24-53](http://noback.upyun.com/2020-06-04-11-24-53.png)
登录厚德云，点击创建项目
![2020-06-04-11-25-21](http://noback.upyun.com/2020-06-04-11-25-21.png)
选择资源池
![2020-06-04-11-28-04](http://noback.upyun.com/2020-06-04-11-28-04.png)
输入项目信息
![2020-06-04-11-29-00](http://noback.upyun.com/2020-06-04-11-29-00.png)
点击容器部署程序
![2020-06-04-11-29-35](http://noback.upyun.com/2020-06-04-11-29-35.png)
输入项目信息

导入镜像运行项目
![2020-06-04-16-08-21](http://noback.upyun.com/2020-06-04-16-08-21.png)
设置端口转发 ,程序内部开启的是8889端口，这里转发8889-> 80端口
![2020-06-04-16-09-40](http://noback.upyun.com/2020-06-04-16-09-40.png)

![2020-06-04-16-16-13](http://noback.upyun.com/2020-06-04-16-16-13.png)
内部流程 
```bash
先访问nono.guozen.cn ----> CND加速找边缘节点 guochancdn.bo.aicdn.com ---> nm.aicdn.com --> 节点缓存或者源站
```

### 厚德云开启数据库
回到资源池，创建RDS数据库
![2020-06-12-11-07-01](http://noback.upyun.com/2020-06-12-11-07-01.png)
![2020-06-12-11-09-23](http://noback.upyun.com/2020-06-12-11-09-23.png)
选择配置，完成数据库创建

### https开通
进入CDN服务，点击https配置
![2020-06-04-17-56-20](http://noback.upyun.com/2020-06-04-17-56-20.png)
证书管理，添加，购买免费的ssl证书，等待审核通过
![2020-06-04-17-56-43](http://noback.upyun.com/2020-06-04-17-56-43.png)