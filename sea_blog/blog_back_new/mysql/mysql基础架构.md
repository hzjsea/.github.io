---
title: mysql基础架构
date: 2021-12-16 14:20:33
categories:  [mysql]
tags: [mysql]
---


<!--more-->


# mysql基础架构
https://juejin.cn/post/6965661512908144653
![](https://noback.upyun.com/2021-12-16-14-20-42.png!)

连接池组件
管理服务和工具组件
SQL 接口组件
查询分析器组件
优化器组件
缓冲组件
插件式存储引擎
物理文件

从大的层次上可以分为四层：

第一层 连接层：主要负责连接处理、身份验证、安全性等，一般 C/S 架构都会有这一层。

第二层 核心服务层：主要有查询缓存、分析器、优化器、执行器等，以及所有的内置函数（如日期、时间、数学和加密函数等），所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图等。

第三层 存储引擎层：这一层是底层数据存取操作实现部分，由多种存储引擎共同组成。服务器通过API与存储引擎通信，API规避了不同存储引擎的差异，不同存储引擎也不会互相通信。

第四层 数据存储层：文件系统存储数据，存放数据文件、日志文件等，完成与存储引擎的交互

客户端连接
应用程序连接mysql的连接层，才能完整接入驱动 ,接入连接层需要对应的数据库，不同的语言或者框架都有对应的数据库连接驱动，
该驱动会在底层跟数据库建立网络连接，有网络连接，才能去发送请求给数据库服务器，才能基于这个连接去执行各种各样的SQL语句。

## 一条SQL查询的执行路径

看下面的SQL查询执行路径图，总的来说一条SQL查询语句将经过如下过程得到查询结果：
客户端发送一条SQL查询给服务器。
服务器先检查查询缓存，如果命中了缓存，则立刻返回存储在缓存中的结果。否则进入下一阶段。
服务器端进行SQL解析、预处理，再由优化器生成对应的执行计划。
MySQL根据优化器生成的执行计划，调用存储引擎的API来执行查询。
![](https://noback.upyun.com/2021-12-16-14-23-57.png!)

## 客户端连接池
应用程序连接数据库往往是创建多个长连接，我们把它叫做数据库的连接池。
在出去单机模式下， 我们部署的容器会有多个工作线程来处理用户请求，多个线程都会去获取一个数据库连接来访问数据库。不能每次都创建一个新的数据库连接，用完然后销毁，这样效率非常低下，因此客户端需要一个数据库连接池，每次从连接池里拿一个连接来处理SQL请求，用完之后又放回连接池中，避免频繁创建销毁数据库连接。

## mysql连接器



## 数据文件
```bash
# 查看数据文件的目录，在数据文件目录下我们可以看到如下的一些文件。
SHOW VARIABLES LIKE '%datadir%';
# +---------------+-----------------+
# | Variable_name | Value           |
# +---------------+-----------------+
# | datadir       | /var/lib/mysql/ |
# +---------------+-----------------+
```
![](https://noback.upyun.com/2021-12-16-15-10-01.png!)
在`/var/lib/mysql`下会有很多的跟文件夹，每一个数据库都会有一个文件夹

- ib_logfile0、ib_logfile1：Redo log 日志文件。
- 库名/db.opt：记录这个数据库默认使用的字符集和校验规则
- .frm：存储表相关的元数据信息，包含表结构的定义信息等，每一张表都会有一个frm文件与之对应。

![](https://noback.upyun.com/2021-12-16-15-32-45.png!)
![](https://noback.upyun.com/2021-12-16-15-42-10.png!)