---
title: 正则表达式
date: 2021-01-26 15:56:16
categories:  [Regex]
tags: [Regex]
---


<!--more-->


# 正则表达式

正则表达式手册 https://tool.oschina.net/uploads/apidocs/jquery/regexp.html

> 正则表达式的流程

简单过滤的正则表达式，可以分成3部分来处理，首部 中间部分 以及尾部


## 匹配次数范围
正则表达式中如下几个可以规定匹配次数的
- `*` 最少匹配零次  最多匹配多次
- `+` 最少匹配一次  最多匹配多次
- `{n,m}` 最少匹配n次 最多匹配m次
- `{n}` 确定匹配n次 
- `{n,}` 最少匹配n次
- `?` 最少匹配0次， 最多匹配1次

## 贪婪与非贪婪
贪婪与非贪婪，正则表达式默认情况下为贪婪模式
在非贪婪模式中,正则会去读取次数范围中最少匹配的内容，标识非贪婪匹配的标记为`匹配次数?`
- `*?` 匹配零次
- `+?` 匹配一次
- `{n,m}?` 匹配n次
- `??` 匹配零次

## 划分组
正则表达式中可以使用`()`来按照小组匹配，所获取的匹配可以从产生的Matches集合得到

## 预匹配
预匹配就是不获取结果，只是先获取以供后面的匹配表达式使用，分为正向预匹配和反向预匹配

预匹配，就看分隔符在哪里，很简单

- `(?:pattern)` 匹配pattern后不获取匹配结果，并且供以后使用，也只有这个是供以后使用的，其他的预匹配是不供使用的,分隔符号在前面, 然后再匹配pattern前面的部分，pattern会被拼接起来

- 正向肯定预查`(?=pattern)` 分隔符号在前面，也就是说会先去匹配pattern，然后再匹配pattern前面的部分，pattern最后不会被拼接起来


比如
![2021-01-26-17-06-56](http://noback.upyun.com/2021-01-26-17-06-56.png)
![2021-01-26-17-07-06](http://noback.upyun.com/2021-01-26-17-07-06.png)

- 正向否定预查`(?!pattern)` 分隔符号在前面，匹配不到pattern后,再去匹配pattern前面的内容,

![2021-01-26-17-11-26](http://noback.upyun.com/2021-01-26-17-11-26.png)
![2021-01-26-17-11-43](http://noback.upyun.com/2021-01-26-17-11-43.png)
![2021-01-26-17-12-14](http://noback.upyun.com/2021-01-26-17-12-14.png)

- 反向肯定预查`(?<=pattern)` 分隔符号在后面
- 反向否定预查`(?<!pattern)` 分割符号在后面

![2021-01-26-18-14-22](http://noback.upyun.com/2021-01-26-18-14-22.png)
![2021-01-26-18-14-32](http://noback.upyun.com/2021-01-26-18-14-32.png)
![2021-01-26-18-14-42](http://noback.upyun.com/2021-01-26-18-14-42.png)

## 查找集合
正则支持字符集查找，使用`[]`划分一个字符集，来做查找范围

- `[xyz]` 匹配xyz
- `[^xyz]` 匹配除xyz
- `[a-z]` 匹配a-z
- `[^a-z]` 匹配除了a-z

## 实战
## 邮件信息中匹配链接地址信息
```python
import re
str = """
error: uncaptured python exception, closing channel <smtpd.SMTPChannel connected 220.181.13.119:57727 at 0x7f69225b2fd0> (<class 'FileNotFoundError'>:[Errno 2] No such file or directory: '/opt/fpben/html/f72312b0.html' [/u
sr/local/python3/lib/python3.8/asyncore.py|read|83] [/usr/local/python3/lib/python3.8/asyncore.py|handle_read_event|420] [/usr/local/python3/lib/python3.8/asynchat.py|handle_read|171] [/usr/local/python3/lib/python3.8/smtp
d.py|found_terminator|386] [server.py|process_message|40] [server.py|parsingContext|94] [server.py|dealWithHtml|62])
<div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"><div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"><p style="margin: 0;">尊敬的唯品会会员，您好：</p><div id="isForwardCo
ntent"><div id="original-content">
<p>感谢您在唯品会购物，发票已经开具完成，如下：</p>
<p>纳税人识别号：无</p>
<p>您可以点击“<a href="https://umcedm.vip.com/collect/report?wrapper=GHtatZz6pvVIv8JjkHWCHvLTto2B3YTRLs9Vo3Uepl3uaH80SHs4aQKJOsw2yZcXN60ZRibnY8qE3kWEYoF6EiNtrnd%2BtJSJZaCgpSkeYp%2F54kpGkIj4%2F6Y5wx9D6PSDGgL%2BTxvYy7hPS%2F6
5cFR04It6WN7bqGIMR6A%2FkFfhv73woTN7fQ2U%2BZNsF9Nd3yY3ZOslqP9w5ZqcIhkRfJw0KF1vS%2BJVPf5wDfnmN7DAALhoS6jPB%2FCnh2juB4khQ212bZK8E4EIwp5AU15GlTExw%2FnlLgsC" target="_blank">电子发票下载</a>”获取发票PDF文件，您也可以在唯品会APP-会员中心-全部订单中选择订单点击“发票详情”查看和下载发票。</p>
<hr align="left" style="border-top: 1px dashed #696969;width:50%;">
<p>电子发票与纸质发票具备同等法律效力，可作为用户维权、保修的有效凭据.</p>
</div></div></div><br><br><span title="neteasefooter"><p>&nbsp;</p></span></div><br><br><span title="neteasefooter"><p>&nbsp;</p></span> /opt/fpben/html/2bbe0020.html
<div style="line-height:1.7;color:#000000;font-size:14px;font-family:Arial"><p style="margin: 0;">尊敬的唯品会会员，您好：</p><div id="isForwardContent"><div id="original-content">
<p>感谢您在唯品会购物，您的订的电子发票已经开具完成，如下：</p>
<p>纳税人识别号：无</p>
<p>您可以点击“<a href="https://umcedm.vip.com/collect/report?wrapper=GHtatZz6pvVIv8JjkHWCHvLTto2B3YTRLs9Vo3Uepl3uaH80SHs4aQKJOsw2yZcXN60ZRibnY8qE3kWEYoF6EiNtrnd%2BtJSJZaCgpSkeYp%2F54kpGkIj4%2F6Y5wx9D6PSDGgL%2BTxvYy7hPS%2F65cFR04It6WN7bqGIMR6A%2FkFfhv73woTN7fQ2U%2BZNsF9Nd3yY3ZOslqP9w5ZqcIhkRfJw0KF1vS%2BJVPf5wDfnmN7DAALhoS6jPB%2FCnh2juB4khQ212bZK8E4EIwp5AU15GlTExw%2FnlLgsCxBD3xgqAvN%2BcQktPYD1IC9U8dDleN2G3UD" target="_blank">电子发票下载</a>”获取发票PDF文件，您也可以在唯品会APP-会员中心-全部订单中选择订单点击“发票详情”查看和下载发票。</p>
<hr align="left" style="border-top: 1px dashed #696969;width:50%;">
<p>电子发票与纸质发票具备同等法律效力，可作为用户维权、保修的有效凭据.</p>
</div></div></div><br><br><span title="neteasefooter"><p>&nbsp;</p></span> /opt/fpben/html/183d60ca.html
"""
regex = (?<=href=")[^<>]+(?=" )
res = re.search(str,regex).group()
```
![2021-01-26-16-06-51](http://noback.upyun.com/2021-01-26-16-06-51.png)

## 匹配snmp oid

```text
.1.3.111.2.802.1.1.26.2.2
ieee8021SpbCompliances OBJECT-TYPE
  -- FROM       IEEE8021-SPB-MIB
::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) 2 }

.1.3.111.2.802.1.1.26.2.2.1
ieee8021SpbComplianceSPBM MODULE-COMPLIANCE
  -- FROM       IEEE8021-SPB-MIB
  DESCRIPTION   "Compliance to IEEE 802.1 SPBM mode"
::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) ieee8021SpbCompliances(2) 1 }

.1.3.111.2.802.1.1.26.2.2.2
ieee8021SpbComplianceSPBV MODULE-COMPLIANCE
  -- FROM       IEEE8021-SPB-MIB
  DESCRIPTION   "Compliance to IEEE 802.1 SPBV mode"
::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) ieee8021SpbCompliances(2) 2 }
```

使用正向预查
```bash
(?:[.0-9]+\n)
```

```golang
package main

import (
    "regexp"
    "fmt"
)

func main() {
    var re = regexp.MustCompile(`(?m)(?:[.0-9]+\n)`)
    var str = `.1.3.111.2.802.1.1.26.2.2
ieee8021SpbCompliances OBJECT-TYPE
  -- FROM       IEEE8021-SPB-MIB
::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) 2 }

.1.3.111.2.802.1.1.26.2.2.1
ieee8021SpbComplianceSPBM MODULE-COMPLIANCE
  -- FROM       IEEE8021-SPB-MIB
  DESCRIPTION   "Compliance to IEEE 802.1 SPBM mode"
::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) ieee8021SpbCompliances(2) 1 }

.1.3.111.2.802.1.1.26.2.2.2
ieee8021SpbComplianceSPBV MODULE-COMPLIANCE
  -- FROM       IEEE8021-SPB-MIB
  DESCRIPTION   "Compliance to IEEE 802.1 SPBV mode"
::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) ieee8021SpbCompliances(2) 2 }`
    
    for i, match := range re.FindAllString(str, -1) {
        fmt.Println(match, "found at index", i)
    }
}
```

```python
# coding=utf8
# the above tag defines encoding for this document and is for Python 2.x compatibility

import re

regex = r"(?:[.0-9]+\n)"

test_str = (".1.3.111.2.802.1.1.26.2.2\n"
	"ieee8021SpbCompliances OBJECT-TYPE\n"
	"  -- FROM       IEEE8021-SPB-MIB\n"
	"::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) 2 }\n\n"
	".1.3.111.2.802.1.1.26.2.2.1\n"
	"ieee8021SpbComplianceSPBM MODULE-COMPLIANCE\n"
	"  -- FROM       IEEE8021-SPB-MIB\n"
	"  DESCRIPTION   \"Compliance to IEEE 802.1 SPBM mode\"\n"
	"::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) ieee8021SpbCompliances(2) 1 }\n\n"
	".1.3.111.2.802.1.1.26.2.2.2\n"
	"ieee8021SpbComplianceSPBV MODULE-COMPLIANCE\n"
	"  -- FROM       IEEE8021-SPB-MIB\n"
	"  DESCRIPTION   \"Compliance to IEEE 802.1 SPBV mode\"\n"
	"::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) ieee8021SpbCompliances(2) 2 }")

matches = re.finditer(regex, test_str, re.MULTILINE)

for matchNum, match in enumerate(matches, start=1):
    
    print ("Match {matchNum} was found at {start}-{end}: {match}".format(matchNum = matchNum, start = match.start(), end = match.end(), match = match.group()))
    
    for groupNum in range(0, len(match.groups())):
        groupNum = groupNum + 1
        
        print ("Group {groupNum} found at {start}-{end}: {group}".format(groupNum = groupNum, start = match.start(groupNum), end = match.end(groupNum), group = match.group(groupNum)))

# Note: for Python 2.7 compatibility, use ur"" to prefix the regex and u"" to prefix the test string and substitution.

```

```rust
// include the latest version of the regex crate in your Cargo.toml
extern crate regex;

use regex::Regex;

fn main() {
  let regex = Regex::new(r"(?m)(?:[.0-9]+\n)").unwrap();
  let string = ".1.3.111.2.802.1.1.26.2.2
ieee8021SpbCompliances OBJECT-TYPE
  -- FROM       IEEE8021-SPB-MIB
::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) 2 }

.1.3.111.2.802.1.1.26.2.2.1
ieee8021SpbComplianceSPBM MODULE-COMPLIANCE
  -- FROM       IEEE8021-SPB-MIB
  DESCRIPTION   \"Compliance to IEEE 802.1 SPBM mode\"
::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) ieee8021SpbCompliances(2) 1 }

.1.3.111.2.802.1.1.26.2.2.2
ieee8021SpbComplianceSPBV MODULE-COMPLIANCE
  -- FROM       IEEE8021-SPB-MIB
  DESCRIPTION   \"Compliance to IEEE 802.1 SPBV mode\"
::= { iso(1) org(3) ieee(111) standards-association-numbers-series-standards(2) lan-man-stds(802) ieee802dot1(1) ieee802dot1mibs(1) ieee8021SpbMib(26) ieee8021SpbConformance(2) ieee8021SpbCompliances(2) 2 }";
  
  // result will be an iterator over tuples containing the start and end indices for each match in the string
  let result = regex.captures_iter(string);
  
  for mat in result {
    println!("{:?}", mat);
  }
}

```