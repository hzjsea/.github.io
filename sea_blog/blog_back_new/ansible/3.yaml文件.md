---
title: yaml格式入门
categories:
  - ansible
tags:
  - ansible
abbrlink: f2b09e22
date: 2020-03-10 17:36:40
---

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [yaml格式](#yaml格式)
  - [yaml语法规则](#yaml语法规则)
  - [yaml支持的数据结构](#yaml支持的数据结构)
  - [yaml基本样例](#yaml基本样例)
    - [对象](#对象)
    - [数组](#数组)
    - [纯量](#纯量)
    - [复合结构](#复合结构)
  - [使用pyyaml](#使用pyyaml)
    - [将dict 转换成 yaml文件](#将dict-转换成-yaml文件)
    - [将yaml文件转换成dict文件](#将yaml文件转换成dict文件)
    - [更新操作](#更新操作)

<!-- /code_chunk_output -->
<!-- more -->
# yaml格式
>  YAML（[ˈjæməl] Yet Another Markup Language）是一种数据序列化格式，设计用于人类的可读性和与脚本语言的交互。PyYAML是Python的YAML解析器和生成器。
> PyYAML提供了一个完整的YAML 1.1解析器、Unicode支持、pickle支持、支持扩展API和合理的错误消息。PyYAML支持标准的YAML标记，并提供了特定于Python的标记，允许表示任意的Python对象。
> PyYAML适用于范围广泛的任务，从复杂的配置文件到对象序列化和持久性。
> YAML是一种被认为可以超越XML、JSON的配置文件，最早接触是Spring Boot.........


## yaml语法规则
- 大小写敏感
- 使用缩进表示层级关系
- 缩进时不允许使用Tab键，只允许使用空格。
- 缩进的空格数目不重要，只要相同层级的元素左侧对齐即可
- #表示注释，从这个字符一直到行尾，都会被解析器忽略，这个和python的注释一样,所以只能单行注释

## yaml支持的数据结构
- 对象：键值对的集合，又称为映射（mapping）/ 哈希（hashes） / 字典（dictionary）
- 数组：一组按次序排列的值，又称为序列（sequence） / 列表（list）
- 纯量（scalars）：单个的、不可再分的值。字符串、布尔值、整数、浮点数、Null、时间、日期


## yaml基本样例
```yaml
# 对象
client:
    # 对象:常量
  default-character-set: utf8
  #对象
custom:
  user1:
    pwd: 666
    user: zhangkai
  user2:
    pwd: 999
    user: zhangkai
mysql:
  password: 123
  user: new_root
# 对象
test:
    # 数组
  - one
  - two
  - three

```
### 对象
```yaml
client:
  default: xxx
  other: xxx
```

### 数组
```yaml
- one
- two
- three
```
### 纯量
```yaml
xxx
xxx
zhangkai
new_root
```

### 复合结构
```yaml
client:
  default: xxx
  other: xxx
class:
  - one
  - two
  - three
languages: [Ruby,Perl]
```

## 使用pyyaml
```bash 
pip install pyyaml
pip install -i https://pypi.doubanio.com/simple pyyaml
```

### 将dict 转换成 yaml文件
```bash
  import yaml

  d = {
      "client": {"default-character-set": "utf8"},
      "mysql": {"user": 'root', "password": 123},
      "custom": {
      ¦   "user1": {"user": "zhangkai", "pwd": 666},
      ¦   "user2": {"user": "zhangkai", "pwd": 999},
      }
  }
  # 直接dump可以把对象转为YAML文档
  print(yaml.dump(d))
  with open('./yaml_dump.yaml','w',encoding='utf-8') as f:
    yaml.dump(d, f)
```

输出结果
```bash
client:
  default-character-set: utf8
custom:
  user1:
    pwd: 666
    user: zhangkai
  user2:
    pwd: 999
    user: zhangkai
mysql:
  password: 123
  user: root
```
### 将yaml文件转换成dict文件
```bash
import yaml
  with open('./yaml_dump.yaml','r',encoding='utf-8') as fr:
      data = yaml.load(fr)

  print(data)
```
输出结果
```bash
(env) ➜  test python xx.py
xx.py:4: YAMLLoadWarning: calling yaml.load() without Loader=... is deprecated, as the default Loader is unsafe. Please read https://msg.pyyaml.org/load for full details.
  data = yaml.load(fr,)
```
这里会报错，原因是这样做是不安全的,可以加一个yaml.FullLoader参数
```py
import yaml
  with open('./yaml_dump.yaml','r',encoding='utf-8') as fr:
      data = yaml.load(fr,yaml.FullLoader)

  print(data)
```

### 更新操作
更新操作无非就是把他先转换成dic文件，然后修改完成后转换成yaml文件
```py
import yaml

file_path = './my.yaml'
with open(file_path, 'r', encoding='utf-8') as fr:
    data = yaml.load(fr, yaml.FullLoader)

data['mysql']['user'] = 'new_root'

with open(file_path, 'w', encoding='utf-8') as fw:
    yaml.dump(data, fw)
```