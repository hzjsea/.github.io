---
title: OSI模型应用层
categories:
  - 网络
tags:
  - 网络
abbrlink: c315efab
date: 2020-09-30 10:18:28
---

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [OSI模型应用层](#osi模型应用层)
  - [应用层协议](#应用层协议)
  - [域名系统DNS](#域名系统dns)
    - [域名服务器](#域名服务器)
    - [域名结构](#域名结构)
    - [DNS查询流程](#dns查询流程)
    - [DNS解析流程](#dns解析流程)
    - [DNS为什么使用UDP运输层协议](#dns为什么使用udp运输层协议)
  - [FTP文件传送协议](#ftp文件传送协议)
  - [TELNET远程终端协议](#telnet远程终端协议)
  - [超文本传输协议 HTTP](#超文本传输协议-http)
    - [代理服务器](#代理服务器)
  - [SMTP协议](#smtp协议)
  - [动态主机配置协议DHCP](#动态主机配置协议dhcp)
    - [DHCP配置流程](#dhcp配置流程)
    - [DHCP租用期](#dhcp租用期)
  - [简单网络管理协议SNMP](#简单网络管理协议snmp)

<!-- /code_chunk_output -->
<!-- more -->

# OSI模型应用层
运输层为应用进程和系统之间端与端之间的通信服务，不同的网络应用


## 应用层协议
应用层协议应当包含
- 应用进程交换的报文类型，如请求报文和响应报文
- 各种报文类型的语法，如报文中的各个字段及其详细描述
- 字段的语义，即包含在字段中的信息含义
- 进程何时、如何发送报文，以及对报文进行响应的规则

因特网公共领域的标准应用应用层协议是由`RFC文档`定义而成，比如万维网的应用层协议HTTP(超文本传输协议)就是由RFC 2616 定义的，但有些应用层协议是不公开的，比如一些P2P文件共享系统使用的就是专用应用层协议

引用层很多协议都是基于 `客户-服务器方式`，这里两个角色的特征分别为  客户是服务请求方，服务器是服务提供方

## 域名系统DNS
域名系统DNS(Domain Name Syetem) 是因特网使用的命名系统，域名系统的存在主要是为了方便IP地址的别名化，IP地址最长由12位数字组成，往往很难记住，但是域名的出现可以对IP进行别名，以此来方便记录IP地址

域名系统的设计，在理论情况下 整个因特网可以提供一个域名服务器，进行对域名和IP地址的查询和转换，但是在实际情况中，如果域名系统的单个域名服务器奔溃了，那么整个域名系统就奔溃了， 于是在1983年开始采用层次树状结构的命名方法，并使用分布式的域名系统DNS，DNS的因特网标准是RFC 1034 1035

在这个分布式的域名系统当中，DNS使大多数名字都在本地进行解析，仅少量的解析需要在因特网上通信

DNS的一种简单的设计模式就是在因特网上只使用一个DNS服务器，该服务器包含所有的映射，在这种集中式的设计中，客户机直接将所有查询请求发往单一的DNS服务器，同时该DNS服务器直接对所有查询客户机做出响应，尽管这种设计方式非常诱人，但他不适用当前的互联网，因为当今的因特网有着数量巨大并且在持续增长的主机，这种集中式设计会有单点故障（嗝屁一个，全球着急），通信容量（上亿台主机发送的查询DNS报文请求，包括但不限于所有的HTTP请求，电子邮件报文服务器，TCP长连接服务），远距离的时间延迟（澳大利亚到纽约的举例），维护开销大（因为所有的主机名-ip映射都要在一个服务站点更新）等问题

### 域名服务器
域名到IP地址的解析是由分布在因特网上的许多域名服务器程序共同完成，域名服务器程序在专设的结点上运行，这些运行域名服务器的程序就叫做`域名服务器`

::: tip 
域名解析流程 
:::
当某一个应用进程需要把主机名解析为IP地址时，该应用进程就调用解析程序，并成为DNS的一个客户，把待解析的域名放在DNS请求中，以UDP用户数据方式发给本地域名服务器(UDP)主要是为了减少开销。本地域名服务器在查找域名后，把对应的IP地址放在回答报文中返回，应用进程获得目的主机的IP地址后即可通信

请求失败，当本地域名服务器不能回答该请求，则此域名服务器就暂时成为DNS中的另一个客户，并向其他域名服务器发出查询请求，这种过程直到找到能够回答该请求的域名服务器为止。]

假设运行在用户主机上的某些应用程序（如Webl浏览器或者邮件阅读器）需要将主机名转换为IP地址。这些应用程序将调用DNS的客户机端，并指明需要被转换的主机名。（在很多基于UNIX的机器上，应用程序为了执行这种转换需要调用函数gethostbyname（））。用户主机的DNS客户端接收到后，向网络中发送一个DNS查询报文。所有DNS请求和回答报文使用的UDP数据报经过端口53发送（至于为什么使用UDP，请参看为什么域名根服务器只能有13台呢？ - 郭无心的回答）经过若干ms到若干s的延时后，用户主机上的DNS客户端接收到一个提供所希望映射的DNS回答报文。这个查询结果则被传递到调用DNS的应用程序。因此，从用户主机上调用应用程序的角度看，DNS是一个提供简单、直接的转换服务的黑盒子。但事实上，实现这个服务的黑盒子非常复杂，它由分布于全球的大量DNS服务器以及定义了DNS服务器与查询主机通信方式的应用层协议组成

### 域名结构

早起域名结构使用 `非等级划分`的名字空间，优点是名字简短。但是当用户数量变多之后，非等级划分的名字空间就显得不合常理了，一个是经常变化，一个是太多。
后来采用了层次树状结构的命名方法, 域名被分为顶级域和子域，子域还可以继续划分子域的子域。分别叫做顶级域、二级域、三级域
`格式分时由标号.来隔开不同的等级域`
![2020-09-30-15-23-26](http://noback.upyun.com/2020-09-30-15-23-26.png)

域名DNS规定，域名中的标号都由英文字母和数字组成，`每一个标号不超过63个字符，不区分大小写字母`


::: tip 
顶级域名分类 
:::
- 国家顶级域名nTLD
比如cn表示中国,us表示美国,uk表示英国
- 通用顶级域名gTLD 
com(公司企业) net(网络服务机构) org(非盈利性安组织) int(国际组织) edu(美国专用的教育机构)
- 基础结构域名(infrastucture Domain)
这种顶级域名只有一个,即arpa 用于反向域名解析，因此被称为反向域名

![2020-09-30-15-52-41](http://noback.upyun.com/2020-09-30-15-52-41.png)


### DNS查询流程
![2020-09-30-15-57-51](http://noback.upyun.com/2020-09-30-15-57-51.png)

### DNS解析流程
- 浏览器缓存
当用户通过浏览器访问某域名时，浏览器首先会在自己的缓存中查找是否有该域名对应的IP地址（若曾经访问过该域名且没有清空缓存便存在）；
- 系统缓存
当浏览器缓存中无域名对应IP则会自动检查用户计算机系统Hosts文件DNS缓存是否有该域名对应IP；
- 路由器缓存
当浏览器及系统缓存中均无域名对应IP则进入路由器缓存中检查，以上三步均为客服端的DNS缓存；
- ISP（互联网服务提供商）DNS缓存
当在用户客服端查找不到域名对应IP地址，则将进入ISP DNS缓存中进行查询。比如你用的是电信的网络，则会进入电信的DNS缓存服务器中进行查找；
- 根域名服务器
当以上均未完成，则进入根服务器进行查询。全球仅有13台根域名服务器，1个主根域名服务器，其余12为辅根域名服务器。根域名收到请求后会查看区域文件记录，若无则将其管辖范围内顶级域名（如.com）服务器IP告诉本地DNS服务器；
- 顶级域名服务器
顶级域名服务器收到请求后查看区域文件记录，若无则将其管辖范围内主域名服务器的IP地址告诉本地DNS服务器；
- 主域名服务器
主域名服务器接受到请求后查询自己的缓存，如果没有则进入下一级域名服务器进行查找，并重复该步骤直至找到正确纪录；
- 保存结果至缓存
本地域名服务器把返回的结果保存到缓存，以备下一次使用，同时将该结果反馈给客户端，客户端通过这个IP地址与web服务器建立链接。

### DNS为什么使用UDP运输层协议
一次UDP名字服务器交换可以短到两个包：一个查询包、一个响应包。一次TCP交换则至少包含9个包：三次握手初始化TCP会话、一个查询包、一个响应包以及四次分手的包交换
考虑到效率原因，TCP连接的开销大得，故采用UDP作为DNS的运输层协议，这也将导致只有13个根域名服务器的结果。


## FTP文件传送协议
文件传送协议(File Transfer Protocol)遵守的是RFC 959协议
- FTP 基于TCP协议
- TFTP 基于UDP协议


## TELNET远程终端协议
一个简单的远程终端协议RFC 854
 

## 超文本传输协议 HTTP
HTTP是面向事务的应用层协议
![2020-09-30-16-11-36](http://noback.upyun.com/2020-09-30-16-11-36.png)
每一个万维网网点都有一个服务器进程，他不断的监听TCP的80端口，以便发现是否有浏览器想他发出连接建立请求。一旦监听到连接建立情趣并见了TCP连接之后，浏览器就像万维网服务器发出浏览某个页面的请求，
服务器接着就返回所请求的页面作为相应。最后TCP连接就被释放。在浏览器和服务器之间的请求和响应的交互，必须按照规定的格式和遵循一定的规则，这些全来自于HTTP超文本传输协议
![2020-09-30-16-17-22](http://noback.upyun.com/2020-09-30-16-17-22.png)
![2020-09-30-16-20-29](http://noback.upyun.com/2020-09-30-16-20-29.png)
![2020-09-30-16-20-37](http://noback.upyun.com/2020-09-30-16-20-37.png)


### 代理服务器
代理服务器(proxy server)是一种网络实体，他又称为 万维网高速缓存。代理服务器把最近的一些请求和响应暂存在本地磁盘中，当新请求到达时，若代理服务器发现这个请求与暂时存放的请求相同，就返回暂存的响应，而不需要按URL的地址再次去互联网访问该资源

## SMTP协议
简单邮件传输协议
![2020-10-21-11-56-09](http://noback.upyun.com/2020-10-21-11-56-09.png)

## 动态主机配置协议DHCP
为了把协议软件做成通用和便于移植的，协议软件中的细节内容不会固定在源代码中，他们会把协议软件参数化。给这些参数赋值的动作叫做协议配置。配置的项目主要包括
- IP地址
- 子网掩码
- 默认路由器的IP地址
- 域名服务器的IP地址

如果是固定了IP地址的话，这样的适配性不高 因为不同网络的掩码网关都不一样。人工配置很不方便，于是有了自动协议配置的方法。这种方法采用的协议就是DHCP动态主机配置协议，即插即用联网。

### DHCP配置流程
DHCP使用客户服务器方式，DHCP开启后，需要IP地址的主机在启动时就向DHCP服务器广播发送`发现报文`(将目的IP地址全部置为1，即255.255.255.255),这时该主机就成为DHCP客户。
发送广播报文是因为现在还不知道DHCP服务器在什么地方，因此他将IP数据报的源IP地址设置为0，这样本地网络上的所有主机都能够收到这个广播报文。但只有DHCP服务器才对此广播报文进行回答。DHCP服务器先在其数据库中查找该计算机的配置信息。
若找到，则返回找到的信息，若找不到则从服务器的IP地址池中取一个地址分配给该计算机。DHCP服务器的回答报文叫做`提供报文`
::: tip 
DHCP的服务器建设在哪里？ 
:::
DHCP通常设置在路由器上，每一个网络至少有一个DHCP中继代理，他配置了DHCP服务器的IP地址信息，当DHCP中继代理收到主机A以广播形式发送的报文后，就以单播方式向DHCP服务器转发报文，并等待其回答，收到DHCP服务器回答的提供报文后，DHCP中继代理再把此提供报文发回给主机A。实际上DHCP报文只是UDP用户数据报的数据，他还要加上UDP首部，IP数据报首部以及以太网的MAC帧的首部和尾部后，才能在链路传送。也就是他还要经历 运输层，网络层，数据链路层的封装
![2020-10-21-15-27-12](http://noback.upyun.com/2020-10-21-15-27-12.png)


### DHCP租用期
DHCP服务器分配给DHCP客户的IP地址是临时的，因为DHCP客户只能在一段有限的时间内使用这个分配到的IP地址。DHCP协议把这段时间叫做`租用期`,这个时间由DHCP服务器决定，租用期用4字节的二进制数字表示，单位是秒。 因此可供选择的时间是1s到136年。DHCP客户也可以在客户端提出对租用期的要求，比如windows更新dhcp `https://cloud.tencent.com/developer/news/454392` macos更新dhcp时间 `https://support.apple.com/zh-hk/guide/mac-help/mchlp1545/mac`

dhcp客户使用的udp端口是68 而dhcp服务器使用的udp端口是67 
![2020-10-21-15-36-11](http://noback.upyun.com/2020-10-21-15-36-11.png)
![2020-10-21-15-36-33](http://noback.upyun.com/2020-10-21-15-36-33.png)

## 简单网络管理协议SNMP
SNMP主要用来管理网络设备之间的状态信息。网络管理包括对硬件、软件和人力的使用、综合与协调，以便对网络资源进行监视、测试、配置、分析、评价和控制，这样就能以合理的价格满足网络的一些需求，如实时的运行性能，服务质量等。网络管理常简称为网管。
![2020-10-21-15-40-26](http://noback.upyun.com/2020-10-21-15-40-26.png)-
被管设备需要运行一个程序以便和管理站中的管理程序进行通信，这些运行着的程序叫做网络管理代理程序，简称为`代理`。这些代理程序通过`网络管理协议`来通信。管理程序运行`SNMP客户程序`，而代理程序运行`SNMP服务程序` ，在被管对象上运行的SNMP服务器程序不停的监听来自管理站的SNMP客户端程序的请求。一旦发现就返回管理站所需要的信息  这是一种方式，也就是被动，另外一种则是主动发送的方式。

网络管理协议所要做到的一点就是，若要管理某个对象，就必然会对该对象添加一些软件或者硬件，但是要尽量避免对原有对象的影响。

SNMP的网络管理由三个部分组成，即`SNMP本身`，`管理信息结构SMI`和`管理信息库MIB`
SNMP定义了管理站和代理之间所交换的分组格式，所交换的分组包含各代理中的对象名以及状态值。SNMP负责读取和改变这些数值。

