---
title: 交换机端口动态汇聚和静态汇聚的优缺点对比
categories:
  - 网络
tags:
  - 网络
abbrlink: d1d24d06
date: 2020-07-20 10:48:24
---

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [链路聚合](#链路聚合)
  - [基于的协议 LACP协议](#基于的协议-lacp协议)
  - [汇聚接口中的成员状态](#汇聚接口中的成员状态)
  - [操作 key](#操作-key)
  - [静态汇聚与动态汇聚的优缺点](#静态汇聚与动态汇聚的优缺点)
  - [静态汇聚配置](#静态汇聚配置)
  - [动态汇聚配置](#动态汇聚配置)

<!-- /code_chunk_output -->
<!-- more -->

# 链路聚合


为了增加链路带宽，交换机往往会将多条以太网物理链路捆绑在一起成为一条逻辑链路，同时，这些捆绑在一起的链路通过相互间的动态备份，可以有效地提高链路的可靠性。
![2020-07-20-10-51-54](http://noback.upyun.com/2020-07-20-10-51-54.png)
这样的作用不但增加了链路带宽,也让多条链路之间可以相互备份，起到互备的作用

<font color='red'>如果其中一条链路断了，会发生怎样的问题</font>

将多个以太网端口捆绑在一起所形成的组合称为聚合组，而这些被捆绑在一起的以太网端口就称为该聚合组的成员端口。每个聚合组唯一对应着一个逻辑汇聚接口，我们称之为聚合接口。

## 基于的协议 LACP协议
http://www.jdccie.com/?p=3105

## 汇聚接口中的成员状态

汇聚组中的成员状态

- 选中（Selected）状态：此状态下的成员端口可以参与用户数据的转发，处于此状态的成员端口简称为“选中端口”
- 非选中（Unselected）状态：此状态下的成员端口不能参与用户数据的转发，处于此状态的成员端口简称为“非选中端口”。
  ![2020-07-20-10-56-12](http://noback.upyun.com/2020-07-20-10-56-12.png)

## 操作 key

为了统一一组汇聚组里面端口成员的状态信息，汇聚组中的成员必须具有相同的操作 key
操作 Key 是系统在进行链路聚合时用来表征成员端口聚合能力的一个数值，它是根据成员端口上的一些信息（包括该端口的速率、双工模式等）的组合自动计算生成的，这个信息组合中任何一项的变化都会引起操作 Key 的重新计算。在同一聚合组中，所有的选中端口都必须具有相同的操作 Key。

## 静态汇聚与动态汇聚的优缺点

| 聚合模式     | 成员端口是否开启 LACP 协议 | 优点                                                                | 缺点                                                  |
| ------------ | -------------------------- | ------------------------------------------------------------------- | ----------------------------------------------------- |
| 静态聚合模式 | 否                         | 一旦配置好后，端口的选中/非选中状态就不会受网络环境的影响，比较稳定 | 不能根据对端的状态调整端口的选中/非选中状态，不够灵活 |
| 动态聚合模式 | 是                         | 能够根据对端和本端的信息调整端口的选中/非选中状态，比较灵活         | 端口的选中/非选中状态容易受网络环境的影响，不够稳定   |


## 静态汇聚配置
对于静态聚合模式，用户需要保证在同一链路两端端口的选中/非选中状态的一致性，否则聚合功能无法正常使用
```bash
system-view
interface bridge-aggregation (interface-number)
quit
interface (interface-type) (interface-number)
port link-aggregation group (number) 

# 配置端口的聚合优先级
# link-aggregation (port-priority) (port-priority)
```

## 动态汇聚配置
对于动态聚合模式，聚合链路两端的设备会自动协商同一链路两端的端口在各自聚合组内的选中/非选中状态，用户只需保证本端聚合在一起的端口的对端也同样聚合在一起，聚合功能即可正常使用。 
```bash
# 配置系统的LACP优先级 
# lacp system-priority system-priority

interface bridge-aggregation (interface-number)
link-aggregation mode dynamic
quit
interface (interface-type) (interface-number)
port link-aggregation group (number)
```
