---
title: 交换机升级步骤
categories:
  - 网络
tags:
  - 网络
abbrlink: 2c7b0ff4
date: 2020-03-04 15:31:56
---


<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [交换机升级步骤](#交换机升级步骤)
  - [如何使用ftp](#如何使用ftp)
  - [升级步骤](#升级步骤)

<!-- /code_chunk_output -->

<!-- more -->

# 交换机升级步骤
https://blog.51cto.com/weidawei/2320286

## 如何使用ftp
```bash
## 建立ftp连接
ftp domain.com
ftp 192.168.0.1
ftp user@ftpdomain.com

## 获取方法
>ftp put file # 上传文件
>ftp ls # 列出远程机器上的文件目录
>ftp get file # 获取文件

```

登陆成功
![2020-03-04-15-37-02](http://noback.upyun.com/2020-03-04-15-37-02.png)

## 升级步骤
存在情况:
1.交换机仅内网
2.交换机配有外网


**第一种解决方法**
机器在内网,无法使用外网的机器进行文件传输，解决方法。登录同网段的内网机器，用ftp传文件

先使用tftp上传文件到服务器(115.231.100.91)，再登录服务器，使用ftp连接远程交换机
```bash
ftp  (远程服务器IP)192.168.20.22
# 按照提示输入用户名及密码
# 登录完成后，传输文件
put 绝对路径+要传输的文件

# 传输文件到指定目录，先使用ftp登录远程服务器，然后cd到指定目录下，再使用put传输文件
ftp xxxip
cd test/soft/
put xxx.ipe
```



**第二种情况交换机的解决办法**
PC本地通过winscp传输ipe文件到交换机上
并设定主要镜像为所传的ipe文件


1. 下载ipe升级软件
下载地址为:http://10.0.8.10/dl/comware/
2. 下载winscp
下载地址为:https://winscp.net/eng/download.php
3. 登录所需要升级的交换机,配置升级交换机的角色，bash
```bash
# 开启ftp服务
ftp server enable
# 在本地建立用户
system-view 
local-user abc class manage
password simple 123456
# 设定用户的工作地址为 flash:/
authorization-attribute user-role network-admin work-directory flash:/
# 开通用户权限，与admin保持一致
service-type ftp
authorization-attribute user-role level-3
authorization-attribute user-role network-admin
authorization-attribute user-role network-operator
```
4. 使用winscp传输文件
形式：ftp 
hostname : 公网IP
username : abc 
password : 123
拖入文件，完成传输

5. 设置交换机启动项
\<h3c>boot-loader file flash:/xxxx.ipe slot 1 main

6. 后续处理
关闭ftp
undo ftp server enable
删除角色




**第二种情况交换机的解决办法(2)**
直接使用scp传输文件
https://docs.google.com/document/d/1TZmYLlFvITRnZdVdnCuakIXoSfXudx_lU09W2mi5NHg/edit


## http升级
开启http服务 或者使用python3 -m http.server
开启http服务，这里用了一个go的http服务器，路径在 netops上的hzj/server
运行如下 ./server 会 开启一个http://115.231.100.91:9999的端口用来下载文件
登录交换机 使用
<h3c> copy http://115.231.100.91:9999/hzj/xxx.ipe flash:/
Y
就可以下载成功了 
一直不通可能是因为没有添加原地址
copy http://112.17.251.25:8000/S6520X-CMW710-R6515P06.ipe flash:/ source interface Vlan-interface 1