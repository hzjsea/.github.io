---
title: 内容记录
categories:
  - machine
tags:
  - machine
abbrlink: 899b698f
date: 2019-12-29 13:13:50
---





<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

- [网络工作流程以及处理方案](#网络工作流程以及处理方案)
  - [交换机命名格式](#交换机命名格式)
  - [交换机ipv6检测内容](#交换机ipv6检测内容)
  - [ipv6配置](#ipv6配置)
  - [配置案例](#配置案例)
  - [无法联网](#无法联网)
  - [整理香港ntt点ip对应关系](#整理香港ntt点ip对应关系)
    - [ntt机器对应脚本](#ntt机器对应脚本)
    - [底层设备到网络配置](#底层设备到网络配置)

<!-- /code_chunk_output -->


<!--more -->

# 网络工作流程以及处理方案

## 交换机命名格式
三大运营商缩写 + 附近机场代码 + S01等
```bash
移动 CMN
电信 CTN
联通 CUN
三线 MIX CMN CTN CUN
```

## 交换机ipv6检测内容
原因 内网机器比如全是移动的，交换机配的移动的ip，下面配的也是移动的ip
这样ping的通，但是联通的服务器ip ping不同。也就是说是内网通，外网不同。
内网ping 网关肯定通

检测：
用移动的交换机下面的服务器（出问题的交换机）  去mtr外网的ip，去看是哪里断掉的
而不是用外网的机器来mtr内网的ip，这样截止的地方会看不出来，因为不是内网的机器

## ipv6配置
```bash
#业务vlan
interface Vlan-interface1
ipv6 address +业务vlan ip
undo ipv6 nd ra halt
#互联vlan
interface Vlan-interface200
ipv6 address  +互联本地ip
#默认路由
ipv6 route-static :: 0 + 互联对端ip
```

## 配置案例
```bash

广东广州移动机房（自有机房NM）：2409:8C54:B000:0704::/64   互联地址 机房：FEC0::C/127， 我司 FEC0::D/127

vlan 1 
ip address 2409:8C54:B000:0704::/64 
undo ipv6 nd ra halt
vlan 20
ipv6 address FEC0::D/127
router-static
ipv6 route-static :: 0 FEC0::C

山东济南移动机房（自有节点NM）：2409:8C3C:0004:000C::/64，互联地址为：2409:8C3C:00FF:0004::000E/127、 我司 2409:8C3C:00FF:0004::0010/127

vlan 1
ip address 2409:8C3C:0004:000C::/64
undo ipv6 nd ra halt
vlan 20
ipv6 address 2409:8C3C:00FF:0004::0010/127
route-static
ipv6 route-static :: 0 2409:8C3C:00FF:0004::000E
vlan 1
ipv6 address 240E:E9:B804:3:400::1/72
undo ipv6 nd ra halt
vlan 30 
ipv6 address 240E:E9:B804:3:200::A3/127
ipv6 address 240E:E9:B804:3:200::B3/127
router-static
ipv6 route-static :: 0 240E:E9:B804:3:200::A3
```

## 无法联网
1. 首先ping交换机ip  看是否通
2. 串口线连接交换机  ping网关是否通不通  10.0.0.130
3. 查看端口状态
dis int brief  
聚合口是否起来 端口是否起来 pvid是否对应1000(统一是1000 除个别外可以在上联交换机上看10.0.0.130)

4. 硬件问题 
看模块是否发光  看跳线是否发光


## 整理香港ntt点ip对应关系
1. 登陆netop服务器
2. 登陆香港ntt交换机
3. 查看vlan1 对应ip 其中157.xxx/27 
```bash
[NTT-CN-HKG-S01-Vlan-interface1]display this
#
interface Vlan-interface1
 ip address 157.119.232.1 255.255.255.224
 ip address 10.81.0.254 255.255.255.0 sub
 ip address 103.211.192.221 255.255.255.252 sub
 ip address 103.251.128.1 255.255.255.224 sub
 ip address 157.119.232.65 255.255.255.224 sub
 ip address 192.168.1.1 255.255.255.0 sub
 ip address 192.168.128.1 255.255.255.0 sub
 ip address 192.168.232.1 255.255.255.224 sub
 ipv6 address 2405:FD80:110::1/52
#
return 
```
在netop服务器上用fping -g 157.119.231.1/27 来查看对应ip的状态

```bash
[root@NETOPS machines]# fping -g 157.119.232.65/27
157.119.232.65 is alive
157.119.232.66 is alive
157.119.232.67 is alive
157.119.232.68 is alive
157.119.232.69 is alive
157.119.232.70 is alive
157.119.232.71 is alive
157.119.232.72 is alive
157.119.232.73 is alive
157.119.232.74 is alive
157.119.232.75 is alive
157.119.232.85 is alive
157.119.232.87 is alive
157.119.232.86 is alive
157.119.232.88 is alive
157.119.232.89 is alive
157.119.232.90 is alive
157.119.232.91 is alive
157.119.232.76 is unreachable
157.119.232.77 is unreachable
157.119.232.78 is unreachable
157.119.232.79 is unreachable
157.119.232.80 is unreachable
157.119.232.81 is unreachable
157.119.232.82 is unreachable
157.119.232.83 is unreachable
157.119.232.84 is unreachable
157.119.232.92 is unreachable
157.119.232.93 is unreachable
157.119.232.94 is unreachable
[root@NETOPS machines]# fping -g 157.119.232.1/27
157.119.232.1 is alive
157.119.232.2 is alive
157.119.232.3 is alive
157.119.232.4 is alive
157.119.232.5 is alive
157.119.232.6 is alive
157.119.232.7 is alive
157.119.232.8 is alive
157.119.232.9 is alive
157.119.232.10 is alive
157.119.232.11 is alive
157.119.232.12 is alive
157.119.232.13 is alive
157.119.232.14 is alive
157.119.232.15 is alive
157.119.232.16 is alive
157.119.232.17 is alive
157.119.232.19 is alive
157.119.232.18 is alive
157.119.232.20 is alive
157.119.232.21 is alive
157.119.232.22 is alive
157.119.232.23 is alive
157.119.232.24 is alive
157.119.232.25 is alive
157.119.232.26 is alive
157.119.232.27 is alive
157.119.232.28 is alive
157.119.232.29 is alive
157.119.232.30 is alive
```


查看inventory中对应关系
```bash
[root@NETOPS machines]# grep 157.119.232.73 /root/mingtao/inventory/machines/*
/root/mingtao/inventory/machines/lists-upapp-01:157.119.232.73
[root@NETOPS machines]# grep 157.119.232.30 /root/mingtao/inventory/machines/*
/root/mingtao/inventory/machines/lists-cdn-v406:# NTT-CN-HKG-030 ansible_ssh_host=157.119.232.30
/root/mingtao/inventory/machines/lists-openstack:# NTT-CN-HKG-030 ansible_ssh_host=157.119.232.30
/root/mingtao/inventory/machines/lists-openstack:OPK-HKG-M30 ansible_ssh_host=157.119.232.30
/root/mingtao/inventory/machines/lists-upops:NTT-CN-HKG-030 ansible_ssh_host=157.119.232.30
[root@NETOPS machines]# grep 157.119.232.29 /root/mingtao/inventory/machines/*
/root/mingtao/inventory/machines/lists-cdn-v406:# NTT-CN-HKG-029 ansible_ssh_host=157.119.232.29
/root/mingtao/inventory/machines/lists-openstack:# NTT-CN-HKG-029 ansible_ssh_host=157.119.232.29
/root/mingtao/inventory/machines/lists-upapp-01:157.119.232.29
[root@NETOPS machines]# grep 157.119.232.20 /root/mingtao/inventory/machines/*
[root@NETOPS machines]# grep 157.119.232.24 /root/mingtao/inventory/machines/*
[root@NETOPS machines]# grep 157.119.232.21 /root/mingtao/inventory/machines/* 
```
记录机器的对应名字



### ntt机器对应脚本
```bash
#!/usr/bin/bash
# add ip (active and unknown)
fping -g 157.119.232.65/27 > ntt_machine
fping -g 157.119.231.1/27 >> ntt_machine

# filter active to tmp.txt
awk '{if($3=="alive"){print $1}}' > tmp.txt ntt_machine

# Calculate the total
nums=`cat tmp.txt | wc -l`

# reset result.txt to blank
echo "result:" > result.txt

# filter ip
for i in `seq 1 $nums`
do
        ip=`awk "NR==$i" tmp.txt`
        link=`grep -w $ip mingtao/inventory/machines/machines/*`
        link=`echo $link | awk -F":" '{print $2}' `
        link=`echo $link | awk '{if($1=="#"){print $2}else{print $1}}'`
        echo  $ip   ,"active"   ,   $link >> result.txt
done

# add unknown to tmp.txt
awk '{if($3!="alive"){print $1,$3}}' >> result.txt ntt_machine
~
```

### 底层设备到网络配置
![2019-12-31-11-26-32](http://noback.upyun.com/2019-12-31-11-26-32.png)
通过该tower截图来获取网络配置需求
15台1U服务器
1台5130交换机
2个万兆多模模块
30根网线
16根电源线

1个万兆口



1-30口汇聚
49口接上联 走trunk
