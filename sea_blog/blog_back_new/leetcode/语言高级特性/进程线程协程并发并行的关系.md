---
title: 进程线程协程的关系
categories:
  - 高级特性
tags:
  - 高级特性
abbrlink: 943589ce
date: 2020-09-29 10:32:12
---

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->
<!-- more -->


# 进程线程协程之间的关系

对操作系统来说，线程是最小的执行单元，进程是最小的资源管理单元。他们都是由操作系统所管理的

![2020-09-29-10-34-44](http://noback.upyun.com/2020-09-29-10-34-44.png)


## 进程
进程就是应用程序的启动实例。比如我们运行一个游戏，打开一个软件，就是开启了一个进程。
`进程拥有代码和打开的文件资源、数据资源、独立的内存空间`
进程，保存在硬盘上的程序运行以后，会在内存空间里形成一个独立的内存体，这个内存体有自己独立的地址空间，有自己的堆，上级挂靠单位是操作系统
操作系统会以进程为单位，分配系统资源（CPU时间片、内存等资源），进程是资源分配的最小单位，是操作系统进行资源分配和调度的一个独立单位
进程一般由程序，数据集合和进程控制块三部分组成



## 线程
线程从属于进程，是程序的实际执行者。一个进程至少包含一个主线程，也可以有更多的子线程。
线程拥有自己的栈空间

![2020-09-29-10-33-55](http://noback.upyun.com/2020-09-29-10-33-55.png)


### 线程之间的协助模式
最经典的就是 `生产者与消费者模式` ，若干个生产者线程向队列中写入数据，若干个消费者线程从队列中消费数据。
![2020-09-29-10-35-54](http://noback.upyun.com/2020-09-29-10-35-54.png)


## 协程
协程，英文Coroutines，是一种比线程更加轻量级的存在。正如一个进程可以拥有多个线程一样，一个线程也可以拥有多个协程。
协程拥有自己的寄存器上下文和栈。
协程调度切换时，将寄存器上下文和栈保存到其他地方，在切回来的时候，恢复先前保存的寄存器上下文和栈，直接操作栈则基本没有内核切换的开销，
可以不加锁的访问全局变量，所以上下文的切换非常快。

![2020-09-29-10-39-06](http://noback.upyun.com/2020-09-29-10-39-06.png)

`协程不是被操作系统内核所管理，而完全是由程序所控制（也就是在用户态执行）`
协程的开销远远小于线程的开销

## 并发
并发偏重于多个任务交替执行，而多个任务之间有可能还是串行的。并发是逻辑上的同时发生（simultaneous） 单核CPU上做并发处理
指在同一时刻只能有一条指令执行，但多个进程指令被快速的轮换执行，使得在宏观上具有多个进程同时执行的效果，但在微观上并不是同时执行的，只是把时间分成若干段，使多个进程快速交替的执行。这就好像两个人用同一把铁锨，轮流挖坑，一小时后，两个人各挖一个小一点的坑，要想挖两个大一点得坑，一定会用两个小时。

![2020-09-29-10-51-56](http://noback.upyun.com/2020-09-29-10-51-56.png)
![2020-09-29-10-53-10](http://noback.upyun.com/2020-09-29-10-53-10.png)


## 并行
并行是物理上的同时发生。然而并行的偏重点在于”同时执行” 多核CPU上面做并行处理
指在同一时刻，有多条指令在多个处理器上同时执行。就好像两个人各拿一把铁锨在挖坑，一小时后，每人一个大坑。所以无论从微观还是从宏观来看，二者都是一起执行的
![2020-09-29-10-52-39](http://noback.upyun.com/2020-09-29-10-52-39.png)


## 概念
- 进程是计算器最小资源分配单位
- 线程是CPU调度的最小单位
- 进程切换需要的资源很最大，效率很低
- 线程切换需要的资源一般，效率一般（当然了在不考虑GIL的情况下）
- 协程切换任务资源很小，效率高（协程本身并不存在，是程序员通过控制IO操作完成） 
- 多进程、多线程根据cpu核数不一样可能是并行的，但是协程是在一个线程中 所以是并发.